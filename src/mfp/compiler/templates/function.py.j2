# compiled/{{ server_name }}/functions.py — GENERATED BY MFP COMPILER
# Server: {{ server_name }} — {{ description }}
# DO NOT EDIT MANUALLY. Re-run `mfp compile` to regenerate.
"""{{ server_name | title }} API Functions — Auto-generated by MFP."""
from __future__ import annotations

import os
from typing import Any

import httpx

_BASE_URL: str = os.environ["MFP_{{ server_name | upper }}_BASE_URL"]
_AUTH_HEADER: str = os.environ.get("MFP_{{ server_name | upper }}_AUTH", "")


def _headers() -> dict[str, str]:
    """Build request headers, injecting auth if configured."""
    h: dict[str, str] = {"Content-Type": "application/json", "Accept": "application/json"}
    if _AUTH_HEADER:
        key, _, value = _AUTH_HEADER.partition(":")
        h[key.strip()] = value.strip()
    return h


def _request(
    method: str,
    path: str,
    params: dict[str, Any] | None = None,
    json_body: dict[str, Any] | None = None,
) -> Any:
    """Execute an HTTP request against the {{ server_name }} API.

    Args:
        method: HTTP method (GET, POST, etc.).
        path: URL path to append to base URL.
        params: Optional query parameters.
        json_body: Optional JSON request body.

    Returns:
        Parsed JSON response.

    Raises:
        httpx.HTTPStatusError: On 4xx/5xx responses.
    """
    url = f"{_BASE_URL}{path}"
    filtered_params = {k: v for k, v in (params or {}).items() if v is not None}
    r = httpx.request(
        method,
        url,
        headers=_headers(),
        params=filtered_params if filtered_params else None,
        json=json_body,
        timeout=15.0,
    )
    r.raise_for_status()
    try:
        return r.json()
    except Exception:
        return r.text


# --- API Functions ---

{% for fn in functions %}
def {{ fn.name }}({{ fn.signature }}) -> Any:
    """{{ fn.summary }}

    {% if fn.description and fn.description != fn.summary %}
    {{ fn.description }}

    {% endif %}
    Args:
        {% for arg in fn.docstring_args %}
        {{ arg.name }}: {{ arg.description }}{% if arg.required %} (required){% else %} (optional){% endif %}

        {% endfor %}
    Returns:
        {% if fn.response_fields %}
        dict with keys: {{ fn.response_fields | join(", ") }}
        {% else %}
        API response data.
        {% endif %}
    """
    {% if fn.has_query_params %}
    _params: dict[str, Any] = {{ fn.params_dict }}
    {% endif %}
    return _request(
        "{{ fn.method }}",
        {{ fn.path_expr }},
        {% if fn.has_query_params %}
        params=_params,
        {% else %}
        params=None,
        {% endif %}
        {% if fn.has_body %}
        json_body=json_body,
        {% else %}
        json_body=None,
        {% endif %}
    )

{% endfor %}
